# 캘린더 애플리케이션 - 반복 일정 기능 명세
## Version: v1.1 (시나리오 보완)
## 담당: PM (10년차)

---

## 🧩 기능 1. 반복 유형 선택 (Select Repeat Type)

### 목적
사용자가 일정 생성 또는 수정 시 **반복 주기(반복 유형)** 를 명확히 선택할 수 있도록 한다.  
반복 일정은 매일, 매주, 매월, 매년 네 가지 형태를 지원하며,  
특정 날짜(예: 31일, 윤년 2월 29일) 처리 로직을 명시한다.

### 시나리오
- 사용자는 “일정 추가” 또는 “일정 수정” 화면에서 **반복 설정 토글을 활성화**할 수 있다.
- 토글을 켜면 "반복 유형 선택 드롭다운"이 나타난다.
- 선택 가능한 옵션은 다음과 같다:
  - 매일(Daily)
  - 매주(Weekly)
  - 매월(Monthly)
  - 매년(Yearly)
- 각 반복 유형 선택 시 동작:
  - **매일**: 선택한 시작일로부터 매일 동일 시간대에 반복 일정 생성.
  - **매주**: 선택일 기준 동일 요일에 반복 생성 (예: 월요일 시작 → 매주 월요일 반복).
  - **매월**: 시작일의 일자를 기준으로 매월 생성.
    - 단, 31일 선택 시 31일이 존재하지 않는 달은 생성하지 않는다.
  - **매년**: 시작일의 월·일을 기준으로 매년 생성.
    - 윤년의 2월 29일일 경우, 윤년이 아닌 해에는 생성하지 않는다.
- 사용자는 반복 일정의 미리보기 목록을 확인할 수 있다 (예: "매월 31일마다 생성됩니다").
- 저장 버튼을 누르면 선택된 반복 유형에 따라 전체 일정이 생성된다.
- 반복 일정은 일정 겹침(중복)을 고려하지 않는다 — 겹쳐도 생성 가능하다.
- 일정 저장 후, 캘린더 뷰에서 자동으로 새 반복 일정이 렌더링된다.

---

## 🧩 기능 2. 반복 일정 표시 (Display Recurring Event)

### 목적
캘린더 뷰에서 반복 일정이 일반 일정과 구분되어 **시각적으로 식별 가능**하도록 한다.

### 시나리오
- 사용자가 캘린더를 열면 모든 일정 데이터가 렌더링된다.
- `repeatType`이 `none`이 아닌 일정에는 반복 아이콘(🔁)이 함께 표시된다.
- 반복 일정의 아이콘 위치: 일정 제목의 우측.
- 반복 유형에 따라 색상 또는 스타일을 다르게 표시할 수 있다.
  - 매일: 회색
  - 매주: 파란색
  - 매월: 초록색
  - 매년: 보라색
- 마우스 오버 시 툴팁으로 “반복 일정” 문구가 표시된다.
- 모바일 환경에서는 아이콘 대신 "반복" 텍스트 뱃지를 표시한다.
- 접근성(ARIA) 라벨: `aria-label="반복 일정"`으로 지정한다.
- 일정 데이터가 누락되거나 아이콘이 로드되지 않아도 캘린더 표시에는 영향을 주지 않는다.

---

## 🧩 기능 3. 반복 종료 설정 (Set Recurrence End)

### 목적
사용자가 반복 일정의 **종료 시점**을 지정하여 일정 생성 범위를 제한할 수 있도록 한다.

### 시나리오
- 기본값: “종료 없음 (무한 반복)”.
- 사용자는 “반복 종료” 드롭다운에서 다음 중 하나를 선택할 수 있다.
  - 없음(None)
  - 특정 날짜까지(Until specific date)
- “특정 날짜까지”를 선택하면 달력(DatePicker)이 나타난다.
- 사용자가 종료일을 `2025-12-31`로 선택하면 해당 날짜 이후의 일정은 생성되지 않는다.
- 시작일보다 이전 날짜를 선택하면 오류 메시지 표시: “종료일은 시작일 이후여야 합니다.”
- 종료일 미입력 시 무한 반복으로 처리.
- 반복 종료일 변경 후 저장 시, 시스템은 기존 생성된 일정 중 범위를 벗어난 일정을 삭제한다.

---

## 🧩 기능 4. 반복 일정 수정 (Edit Recurring Event)

### 목적
반복 일정 수정 시, 단일 일정만 수정할지 또는 전체 반복 일정을 수정할지를 사용자에게 명확히 선택하도록 한다.

### 시나리오
- 사용자가 반복 일정을 클릭 후 “수정” 버튼을 누르면 팝업이 표시된다.
  > “해당 일정만 수정하시겠어요?”
- 선택지:
  1. “예” → 단일 수정
     - 해당 일정만 수정되고, `repeatType`은 `none`으로 변경된다.
     - 반복 그룹(`groupId`)에서 분리되어 독립 일정으로 전환된다.
     - 반복 아이콘(🔁)이 사라진다.
     - 수정된 일정은 반복 일정이 아닌 단일 일정으로 표시된다.
  2. “아니오” → 전체 수정
     - 동일한 `groupId`를 가진 모든 일정이 함께 수정된다.
     - 반복 속성(`repeatType`) 유지.
     - 반복 아이콘 유지.
- 수정된 데이터는 즉시 캘린더에 반영된다.
- 예외 상황: 존재하지 않는 일정 수정 시 “수정할 대상을 찾을 수 없습니다.” 표시.

---

## 🧩 기능 5. 반복 일정 삭제 (Delete Recurring Event)

### 목적
사용자가 반복 일정을 삭제할 때, 단일 일정 삭제 또는 전체 반복 삭제 중 선택할 수 있도록 한다.

### 시나리오
- 사용자가 반복 일정을 클릭 후 “삭제”를 선택하면 팝업이 표시된다.
  > “해당 일정만 삭제하시겠어요?”
- 선택지:
  1. “예” → 단일 일정 삭제
     - 해당 일정만 삭제된다.
     - 반복 그룹(`groupId`)의 나머지 일정은 유지된다.
     - 삭제된 일정은 캘린더에서 fade-out 애니메이션과 함께 사라진다.
  2. “아니오” → 전체 삭제
     - 동일한 `groupId`를 가진 모든 반복 일정 삭제.
     - 삭제 후 “반복 일정이 모두 삭제되었습니다.” 메시지 표시.
- 예외 상황:
  - 이미 삭제된 일정 클릭 시 “이미 삭제된 일정입니다.” 표시.
  - 서버 오류 시 “삭제에 실패했습니다. 다시 시도해주세요.” 메시지 표시.

---

## 🧩 기능 6. 공통 예외 및 데이터 정책

### 목적
모든 반복 일정 기능이 일관성 있게 동작하도록 공통 예외 처리와 데이터 관리 정책을 정의한다.

### 시나리오
- 반복 일정은 `groupId`를 통해 그룹 단위로 관리된다.
- 단일 수정 또는 삭제 시, `groupId`가 제거되어 독립 일정으로 분리된다.
- 반복 일정 생성 시, 겹치는 일정도 허용된다.
- 오류 발생 시 Toast 메시지로 사용자에게 즉시 피드백을 제공한다.
- 반복 일정 생성 및 수정 후에는 항상 UI가 자동 갱신되어야 한다.

---

## ✅ 작업 단위(Task) 정리

| 기능 번호 | 작업 단위(Task Name) | 담당 (BMAD 기준) | 우선순위 |
|------------|----------------------|------------------|-----------|
| FUNC-001 | 반복 유형 선택 로직 및 UI 구현 | Analyst → Dev | ⭐⭐⭐⭐ |
| FUNC-002 | 반복 일정 아이콘 렌더링 처리 | Dev | ⭐⭐⭐ |
| FUNC-003 | 반복 종료 조건 로직 | Analyst → Dev | ⭐⭐⭐⭐ |
| FUNC-004 | 반복 일정 수정 모드 로직 | Dev + Architect | ⭐⭐⭐⭐ |
| FUNC-005 | 반복 일정 삭제 로직 | Dev | ⭐⭐⭐ |
| FUNC-006 | 데이터 및 예외 공통 처리 | Architect + TEA | ⭐⭐⭐ |

